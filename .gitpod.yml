tasks:
  - init: npm install

  - name: Accounts Service
    before: cd accounts-service
    init: npm install
    command: |
      export CLIENT_URL=$(gp url 3000)
      export GOOGLE_OAUTH_CALLBACK_URL=$REACT_APP_SERVER_URL/accounts-service/auth/google/callback
      npm run dev

  - name: Messages Service
    before: cd messages-service
    init: npm install
    command: |
      export CLIENT_URL=$(gp url 3000)
      npm run dev

  - name: Client
    before: cd client
    init: npm install
    command: |
      export REACT_APP_CLIENT_URL=$(gp url 3000)
      export REACT_APP_SERVER_URL=$(gp url 8000)
      npm start

  - name: Infra
    before: cd infra
    init: terraform init
    
image:
  file: .gitpod.Dockerfile